<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Tracking List</title>
  </head>
  <body>
    <h2>Tracking list</h2>
    <a href="/dashboard">Dashboard</a>
    <a href="/tracking/initial">Khởi tạo</a>
    <table border="1" cellpadding="8" cellspacing="0">
      <thead>
        <tr>
          <th>#</th>
          <th>Lot Code</th>
          <th>Product</th>
          <th>Category</th>
          <th>Procedure</th>
          <th>Rework</th>
          <th>Init Time</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="trackingList"></tbody>
    </table>

    <script>
      async function loadTrackingList() {
        try {
          const res = await fetch("/tracking/list");
          const data = await res.json();
          if (!data.success) return alert(data.message || "Lỗi");

          const tbody = document.getElementById("trackingList");
          tbody.innerHTML = "";

          data.data.forEach((item, index) => {
            const row = `<tr>
              <td>${index + 1}</td>
              <td>${item.lot_code}</td>
              <td>${item.product_name}</td>
              <td>${item.category_name}</td>
              <td>${item.procedure_name}</td>
              <td>${item.rework_cycle}</td>
              <td>${new Date(item.created_at).toLocaleString()}</td>
              <td><a href="/tracking/detail/${item.lot_code}/${
              item.rework_cycle
            }">Chi tiết</a></td>
            </tr>`;
            tbody.innerHTML += row;
          });
        } catch (err) {
          console.error("Lỗi tải danh sách:", err);
        }
      }

      window.onload = loadTrackingList;
    </script>
  </body>
</html>
